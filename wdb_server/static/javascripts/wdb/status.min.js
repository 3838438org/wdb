/*! wdb           2014-04-18 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(){this.debug=$("body").attr("data-debug")||!1}return a.prototype.log=function(){var a,b;return this.debug?(b="["+this.constructor.name+"]",a=[b].concat(Array.prototype.slice.call(arguments,0)),console.log.apply(console,a)):void 0},a.prototype.fail=function(){var a,b;return b=this.constructor.name,a=[b].concat(Array.prototype.slice.call(arguments,0)),console.error.apply(console,a)},a}(),j=null,i=25,e=function(a,b){var c;return(c=$(".sessions tr[data-uuid="+a+"]")).size()||(c=$('<tr data-uuid="'+a+'"> <td class="uuid"><a href="/debug/session/'+a+'">'+a+'</a></td> <td class="socket">No</td> <td class="websocket">No</td> <td class="close"> <a class="fa fa-times-circle remove" title="Force close"></a> </td>'),$(".sessions tbody").append(c)),c.find("."+b).text("Yes")},h=function(a,b){var c;if((c=$(".sessions tr[data-uuid="+a+"]")).size())return"socket"===b&&"No"===c.find(".websocket").text()||"websocket"===b&&"No"===c.find(".socket").text()?c.remove():c.find("."+b).text("No")},c=function(a){var b,c,d,e,f;for(c="<tr>",f=["fn","lno","cond","fun"],d=0,e=f.length;e>d;d++)b=f[d],c+='<td class="'+b+'">'+(a[b]||"∅")+"</td>";return c+='<td class="action"> <a class="fa fa-folder-open open" title="Open"></a> <a class="fa fa-minus-circle remove" title="Remove"></a> </td>',c+="</tr>",$(".breakpoints tbody").append($(c))},g=function(a){var b,c,d,e,f,g,h,i,j,k,l;for(j=$(".breakpoints tr"),l=[],f=0,h=j.length;h>f;f++){for(e=j[f],b=$(e),d=!0,k=["fn","lno","cond","fun"],g=0,i=k.length;i>g;g++)c=k[g],d=d&&b.find("."+c).text()===""+(a[c]||"∅");l.push(d?b.remove():void 0)}return l},d=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(d=function(b){var c;return c=a[b],null==c&&(c="∅"),"time"===b?(c=(new Date).getTime()/1e3-c,c=Math.round(c)+" s"):("mem"===b||"cpu"===b)&&(c=c.toFixed(2)+"%"),c},(b=$(".processes tbody tr[data-pid="+a.pid+"]")).size()){for(j=["pid","user","cmd","time","mem","cpu"],l=[],f=0,h=j.length;h>f;f++)c=j[f],l.push(b.find("."+c).text(d(c)));return l}for(e='<tr data-pid="'+a.pid+'" '+(a.threadof?'data-threadof="'+a.threadof+'"':"")+">",k=["pid","user","cmd","time","mem","cpu"],g=0,i=k.length;i>g;g++)c=k[g],e+='<td class="'+c+'">'+d(c)+"</td>";return e+='<td class="action">',e+='<a href="" class="fa fa-pause pause" title="Pause"></a> ',a.threads>1&&(e+='<a href="" class="fa fa-minus minus" title="Toggle threads"></a> '),e+="</td>",e+="</tr>",$(".processes tbody").append($(e))},k=function(a){var b,f,k,m,n,o,p,q,r,s;switch(i=25,m=a.data,n=m.indexOf("|"),n>-1?(f=m.substr(0,n),k=JSON.parse(m.substr(n+1))):(f=m,k=""),f){case"AddWebSocket":return e(k,"websocket");case"AddSocket":return e(k,"socket");case"RemoveWebSocket":return h(k,"websocket");case"RemoveSocket":return h(k,"socket");case"AddBreak":return c(k);case"RemoveBreak":return g(k);case"AddProcess":return d(k);case"KeepProcess":for(r=$(".processes tbody tr"),p=0,q=r.length;q>p;p++)o=r[p],b=$(o),s=parseInt(b.attr("data-pid")),l.call(k,s)<0&&b.remove();return setTimeout(function(){return j.send("ListProcesses")},1e3)}},b=function(){return j=new WebSocket("ws://"+location.host+"/status"),j.onopen=function(){return console.log("WebSocket open",arguments),$("tbody tr").remove(),j.send("ListSockets"),j.send("ListWebSockets"),j.send("ListBreaks"),j.send("ListProcesses")},j.onerror=function(){return console.log("WebSocket error",arguments)},j.onmessage=k,j.onclose=function(){return console.log("WebSocket closed",arguments),i*=2,setTimeout(b,i)}},f=function(a){return"∅"===a?null:a},$(function(){return b(),$(".sessions tbody").on("click",".remove",function(){return j.send("RemoveUUID|"+$(this).closest("tr").attr("data-uuid")),!1}),$(".breakpoints tbody").on("click",".open",function(){var a;return a=$(this).closest("tr"),j.send("RunFile|"+a.find(".fn").text()),!1}),$(".breakpoints tbody").on("click",".remove",function(){var a,b;return a=$(this).closest("tr"),b={fn:a.find(".fn").text(),lno:parseInt(a.find(".lno").text()),cond:f(a.find(".cond").text()),fun:f(a.find(".fun").text())},j.send("RemoveBreak|"+JSON.stringify(b)),!1}),$(".processes tbody").on("click",".pause",function(){return j.send("Pause|"+$(this).closest("tr").find(".pid").text()),!1}).on("click",".minus",function(){var a,b;return a=$(this),b=a.closest("tr"),$("[data-threadof="+b.attr("data-pid")+"]").hide("fast"),a.attr("class",a.attr("class").replace(/minus/g,"plus")),!1}).on("click",".plus",function(){var a,b;return a=$(this),b=a.closest("tr"),$("[data-threadof="+b.attr("data-pid")+"]").show("fast"),a.attr("class",a.attr("class").replace(/plus/g,"minus")),!1}),$(".processes [type=button]").on("click",function(){return j.send("RunFile|"+$(this).siblings("[type=text]").val())})})}).call(this);
//# sourceMappingURL=status.min.map